# QA 悬浮对话框功能实现总结

## 实现的功能

### 1. FloatingQAButton 悬浮按钮
- 固定在页面右下角（默认位置）
- **可拖拽**：支持鼠标和触摸拖拽到任意位置
- **自动吸附**：拖拽结束后自动吸附到最近的角落
- **动画效果**：悬停放大、呼吸动画（未读消息时）
- **未读提示**：显示未读消息数量

### 2. QADialog 对话框
- 居中显示，可调整大小
- **窗口控制**：最小化、关闭按钮
- **模型选择**：顶栏集成 LLM 档案选择器
- **响应式布局**：左侧会话列表 + 右侧聊天区域

### 3. SessionSidebar 会话历史侧边栏
- **会话列表**：显示所有历史会话
- **会话信息**：图标、标题、最后活动时间
- **新建会话**：一键创建新会话
- **删除会话**：支持确认后删除
- **当前会话高亮**：可视化指示当前激活会话

### 4. ChatArea 聊天区域（类 GPT 风格）
- **消息气泡**：用户（右侧蓝色）/ AI（左侧灰色）
- **Markdown 支持**：代码块、行内代码、粗体、斜体
- **引用来源**：显示文档引用，可点击查看
- **复制功能**：悬停显示复制按钮
- **时间戳**：显示发送时间
- **加载动画**：AI 回复时显示打字动画

### 5. MessageInput 输入框
- **多行输入**：支持 Shift+Enter 换行
- **自动调整高度**：根据内容自动扩展
- **发送按钮**：集成在输入框内
- **快捷键**：Enter 发送
- **禁用状态**：未选择模型时禁用

### 6. useQASession Hook 会话管理
- **状态管理**：会话列表、当前会话、消息列表
- **持久化存储**：localStorage 保存会话和消息
- **自动加载**：恢复上次会话状态
- **会话操作**：创建、切换、删除会话
- **消息发送**：调用 API 并处理流式响应
- **错误处理**：友好的错误提示

## 技术栈

- **React 18**：函数组件 + Hooks
- **TypeScript**：类型安全
- **Tailwind CSS**：原子化 CSS
- **Next.js 14**：App Router

## 文件结构

```
src/components/qa/
├── index.ts                    # 导出文件
├── FloatingQAButton.tsx        # 悬浮按钮
├── QADialog.tsx               # 对话框容器
├── QAContainer.tsx            # 主容器
├── SessionSidebar.tsx         # 会话侧边栏
├── ChatArea.tsx               # 聊天区域
└── useQASession.ts            # 会话管理 Hook
```

## 使用方式

在 `translate/page.tsx` 中引入使用：

```tsx
import { QAContainer } from "@/components/qa"

// 在页面组件中使用
<QAContainer docId={translationId || undefined} />
```

## 特性亮点

1. **用户体验**：类似 ChatGPT 的交互设计，直观易用
2. **数据持久化**：会话和消息自动保存，刷新不丢失
3. **可拖拽**：悬浮按钮可自由拖拽到任意位置
4. **响应式**：适配不同屏幕尺寸
5. **类型安全**：完整的 TypeScript 类型定义
6. **性能优化**：使用 useMemo、useCallback 等优化渲染
